import {POINT, sum2, transpose} from '../util';

const parse = (input: string): string[][][] =>
  input
    .trim()
    .split('\n\n')
    .map((a) => a.split('\n').map((b) => b.split('')));

const findReflections =
  (nbDiff: number) =>
  (m: string[][]): POINT => {
    function count(t: string[][]) {
      let r = 0;
      const mx = t[0].length;
      const my = t.length;
      for (let x = 0; x <= mx - 2; x++) {
        const l = Math.min(x + 1, mx - 1 - x);
        let diff = 0;
        for (let y = 0; y < my; y++)
          for (let i = 0; i < l; i++)
            diff += Number(t[y][x - i] !== t[y][x + 1 + i]);
        if (diff === nbDiff) r += x + 1;
      }
      return r;
    }
    return [count(m), count(transpose(m))];
  };

const part1 = (input: string) => {
  const [x, y] = sum2(parse(input).map(findReflections(0)));
  return y * 100 + x;
};

const part2 = (input: string) => {
  const [x, y] = sum2(parse(input).map(findReflections(1)));
  return y * 100 + x;
};

const runs = [1, 1, 1, 1];

const inputSample = `
#.##..##.
..#.##.#.
##......#
##......#
..#.##.#.
..##..##.
#.#.##.#.

#...##..#
#....#..#
..##..###
#####.##.
#####.##.
..##..###
#....#..#
`;

const inputReal = `
##.##......
##.########
...#...##..
..#.#......
###..#....#
###.#......
##..##.##.#
..#...####.
..##..####.
#####.#..#.
###.##.##.#
....#######
#.#........

#..###......#
..#.#........
#.#####....##
..##.#..##..#
.###.#..##..#
#.#####....##
..#.#........
#..###......#
##...#..##..#
#.###..#..#..
.##...##..##.
###.#########
#..#.#.#..#.#
.##.##......#
#..#####..###

.##.....##.
####.#..#.#
#####......
.......#.##
.##..######
#..#.....##
#####..####
.##.....#..
....###....
....###....
.##....##..

.##.###.###...#
....#.##....###
####.###...###.
#..#.##....##..
.....#######.#.
.##.###.....#..
#..#.#....####.
####.##.#..##..
.......#.#####.
.##.......#...#
.....##..#.#.##
.....##..#.#.##
.##.......#...#
.......#.#####.
####.####..##..
#..#.#....####.
.##.###.....#..

#..####..#....#
..##..##..####.
....##.....##..
...#..#........
#.##..##.#.##.#
.##.##.##.####.
.##.##.##......
#......#.######
.#..##..#......

.#..#.#...#....
#.##.#.#.#.....
#....#.##......
#....#.##......
#.##.#.#.#.....
.#..#.#.#.#....
.#..#...###....
.#..#.##.#..##.
########.#.#.#.
#....##.##...#.
.......###.####
......#####.###
.#..#.#.#.###..
##..###..#.#..#
##..##..##.#.##
#########.#.###
#.##.##.###..##

..###.#
####..#
##..##.
##..##.
...#..#
...####
..#.##.
##.####
##.####
####..#
...#..#
##.#..#
..#####
##.####
..#.##.
..#####
....##.

.#.##.##....##.
...#...######..
#....##########
..#.#....##....
#..###.######.#
#..###.######.#
..#.#....##....
#....##########
...#...######..
.#.##.##....##.
.#####..####..#
#......######..
.....##.#..#.#.
.#...###....###
..##..#......#.
##..###.#..#.##
.#.#.#........#

#..#####.##.#..
.#..##.#.####..
...##..##.#..##
.######.#.#.#..
#.#..###.....##
....##..#....##
..##.#.#.#.#.##
##..#...#..##..
#...###..##.###
.###..#.#.#..##
..#.###.##..###
###.#.#####....
#.#.#.#####....
..#.###.##..###
.###..#.#.#..##

#..###.
.....##
#..#..#
#..#..#
.....##
#.####.
#.####.
.....##
#..#..#
#..#..#
.....##
#..###.
.#.#.##

##.#..#####.#
##.#..#####.#
#......#.#..#
##..##......#
..###....#.#.
...###.#.#.##
#.#.##..##.##
#.#.#...##.##
...###.#.#.##

##.#.........
.#.##...#####
#...#####.#..
.....##.#.#..
#.#.#.###..##
#....##...#..
#....##.#.#..

##.##.##.##.##.
..##.###....###
###.#.###..###.
###.##..####..#
..#####.####.##
##....###..###.
..###..#.##.#..
..##....#..#...
...##....##....
###.####.##.###
###.##...#....#
##..#..##..##..
...#..########.
...#.#.######.#
##.#...######..
..#..##......##
..#.####.##.###

.###..#######
..#..########
..###.#....#.
#......#..#..
###..#.#..#.#
#..#.########
##.####....##
##.#..#.##.#.
.#...###..###
#.##..##..##.
.....##.##.##
...##..#..#..
...##..#..#..
.....##.##.##
#.##..##..##.
.#...###..###
##.#..#.##.#.

..###..##
.#.##..##
##.######
.#.......
.#.#....#
##.######
.#.##..##

#..#.###.
#..#.#.#.
.##.#.##.
.#..#.#..
...#.####
...#.####
.#..#.#..

.#..#####.....#
..########...#.
###.#.###.#.#.#
#.###.#..#...#.
#.###.#..#...#.
###.#.###.#.#.#
...#######...#.
.#..#####.....#
..###...##.#.##
###..###...##..
##...#####..#..
....#####.#...#
....#####.#...#
##...#####..#..
###..###...##..

###....#.
###..#...
###...#..
###...#..
###..#...
##.....#.
.########
#..#.#.##
#..#.#.##

##.##.#....
##..#.#....
.#.#.###...
....#..####
..##..###..
#..##.##.##
#######..##
#..######..
.#.#.#.#...

##########.##..
.............#.
.#....#.##..###
##.##.##.##.#.#
############.##
.........####.#
#..##..###.##.#
#..##..##..##.#
.........####.#

.##.#....
.....#.##
...###..#
###..###.
...#.##..
...#.##..
###..###.
...###..#
.....#.##
.##.#....
#...#....
#...#....
###.#....

##.####
###.#.#
...#.#.
###..##
###...#
##.#..#
....###
...#..#
...#..#
....###
###..##
#.###.#
####..#
##.#..#
##.#..#

...#.###...#.#.
#.#...#.#.#....
..#..##.#.#....
.....#####.#..#
.#....###.#.###
#...#####.####.
###...#.##.#.#.
##.#..####..#..
##.#..####..#.#
..#..#..####.##
###.####.##.##.
....###.##.#..#
....###.##.#..#
###.####.##.##.
..#..#..####.##
##.#..####..#.#
##.#..####..#..

..##..###..#.##
..###.##.####.#
..###.##.####.#
..##..###..#.##
#.##...#.##.#.#
#..#..#.##.##..
##.#.###....##.
..#....###.##..
#######..####..
#.###...#...#..
#.####..#...#..

....#.##.#.##.#
.##...##.#....#
####...###.##.#
.##...#........
.....##...####.
#..#..#.##....#
.##....####..##
####...###....#
.##.####.##..##
#..###...#.##.#
.###.###..#..#.
....#.#########
.##.#.####.##.#
.##.##..###..##
#..#.##..##..##

.#..#..#.....
.###.##.###..
.###....###..
....####.....
#.#..##..#.##
####.##.#####
##.#.##.#.###
....####.....
..##....##...
##.##..##.###
##.######.###
..#..##..#...
.##.####.##..

..##..#..####..#.
##..##..#....#..#
#.##.#..##..##..#
##..####......###
#....##.#.##.#.##
######..#.##.#..#
..##.........#...
#....#..#....#..#
#.##.#.########.#
..##...#.#..#.#..
.####.#........#.
#.##.##..#..#..##
#....#..######..#
######.#.#..#.#.#
.#..#..########..

....####...
..#......#.
...#....#..
##...##...#
##...##...#
##..#..#..#
...##..###.
##..#..#..#
.....##....

####....####.
..#.#..#.#..#
#..#....#..##
.#.#....#.###
.#.######.#.#
#####..#####.
...#....#...#
###......####
###......####

#.##.##
#.##.##
####..#
#.#..#.
###.###
.#...##
.##..##
###.###
#.#..#.

.#.#....#.#..
##.#....#.###
##.#....#.###
.#.#....#.#..
..########..#
#.##.##.##.##
.##...#..##..
#.#......#.##
..##....##..#

###..#####.
.#.####.###
.####...###
.####...###
.#.##.#.###
###..#####.
..#.######.
.#.#..#...#
.##.#.##..#
.##.#.##..#
.#.#..#...#
..#.######.
###..#####.

##..#.##.#..#
..#.#....#.#.
#..#..##..#..
#..#..##..#..
#.#.#....#.#.
##..#.##.#..#
..#..#..#..#.
#.#.##..##.#.
##...####...#
...#.#..#.#..
..#.######.#.
##...####...#
.##...##...##

####...#..#..#..#
##.#.####.#..#.##
.#.#.#..##....##.
.##..#.##########
.#.##.#...####...
###.###...####...
.#.#.#.##.####.##
#.##....###..###.
..##...##.#..#.##
..#........##....
...#..#..##..##..
...#..#..##..##..
#.#........##....

#.###...###
....##.#..#
.###.##.##.
.#.###..##.
..####.....
..####.....
.#.###..##.
.###.##.##.
....##.#..#
#.###...###
...#.....##
...#.....##
#.###...###
....#..#..#
.###.##.##.
.#.###..##.
..####.....

.##...##.
....#....
#.####..#
.#..#....
###.#....
#.####..#
.#.##....
####.#..#
.#..#####
###..####
###..####
.#..#####
.###.#..#

####...
...####
#.#....
#.###..
##.....
##..###
##..###
#......
#.###..
#.#....
...####

##..#.#..#.
....###.#..
.########.#
#.####...##
.#.#..#.#.#
#..####.#..
#..####.#.#
.#.#..#.#.#
#.####...##
.########.#
....###.#..
##..#.#..#.
####.......
#.##.##..##
#.##.##..##

.###.##..#.#.####
##.#...###..#####
..#..###.#.#.....
..#.#..#..##.....
..#...####.##.#..
##....##.#.......
##.####.#.#####..
.#.#.##.#.##.#.##
#.##.##..##..####
..###..#.##.###..
.#.###.######.#..
..#...###.##.##..
..#...###.##.##..
.#.###.######.#..
..###..#.##.###..
#.##.##..##...###
.#.#.##.#.##.#.##

#.##.#.#.##....
#.##.#.#.##....
######.####.#..
#######......#.
##########.#..#
.#..#...#...##.
..##.....##..#.
.##.#.##.....##
.#..#...#..#...
.####......##.#
.####.#.###...#
##..###.#......
######...#..#.#

.##....##...#
###########.#
.##....##..#.
####..####.#.
....##......#
..#....#..#..
#..####..#.##

.#..######..#.##.
#.##..##..##.####
.##..####..##....
.####.##.####.##.
###.#.##.#.###..#
..##..##..##..##.
##.##....##.##..#
#.#.#....#.#.#..#
..###.##.###.....
.....#..#..#.....
..##..##..##..##.
..###.##.###..##.
...#......#......

##.#.##.....#.###
.#..##...#.#...#.
#..##.####...###.
..###.###...##..#
.#..########..#.#
##.#.##.##.##.##.
..##..###.###.###
...#..#......#..#
.###...#######..#
.###...#######..#
...#..#......#...
..#######.#.#####
..#######.#.#####
...#..#......#...
.###...#######..#
.###...#######..#
...#..#......#..#

###...#..#.
#.#........
###.#......
....#......
###........
...#..####.
..##.##..##
#####......
..#..#.##.#
..#..#.##.#
##.#...##..
..##.......
######....#
...##......
..#..######

.##.#.##..##.
###...##..##.
.##..#..##..#
.##.#........
#....#..##..#
#.#.##..##..#
.###.########
.#...........
.#.#.........
#.###########
...###..##..#
.####........
..###..#..#..
#..##########
##.#.........

..#.##..#
..#.##..#
##..##..#
..##.###.
####.#.##
#...#.#.#
..#....#.

...#....#....
...#....#....
...######...#
.##..##..##..
##........###
.#..#..#..#..
.....##...#.#
.##......##..
.#...##...#..
...#.##.#...#
##.#....#.##.
...##..##...#
####....#####
...#.##.#...#
#....##....##
#.###..###.##
#.#.#..#.#.#.

.####..#..#..##
#....#...#...#.
#....#.#.#...#.
.####..#..#..##
.####.##...#.#.
.####.##.####.#
#....####.#...#
.#..#...#..#...
.####...#.#.#..

......#..
#.###.#.#
#.###.#..
..#.##.##
#....#.##
.##...#..
...###...
#...#####
#.##.#.##
.#..###..
.#..###..
#.##.#.##
#...#####
...###...
.##...#..

##...........
..#.##.##.##.
####.#.##.#.#
..#..######..
###.########.
##.#..#..#..#
..###......##
##..#.####.#.
....#..##..#.
..#.##...###.
...#..####..#
#####......##
#######..####
######.##.###
###..#.##.#..

.##.##....##..##.
#.###.##.#..##..#
#.#####..........
####.##.##..##..#
..##.#.##.##..##.
.#.#..####.####.#
.##.#####........
#.#...#..#..##..#
..#.#.#..########

.#..###.#
..#.##.##
..#.##.##
.#..###.#
#.#.#####
#.#....##
#.##..###
.#..#....
..#......
.###..#..
.#.#..#..
..#......
.#..#....

##.........
...###..###
...##.##.##
#.##......#
#..##.##.##
##.##.##.##
#....#..#..
##.###..###
.#.........
##.########
.#.##.##.##
.#.##.##.##
##.###..###
.#.........
##.###..###
#....#..#..
##.##.##.##

##..#.#....#.##
.####..#.#.#..#
#..##.####.##.#
.#.....#..##..#
.##.#.#..###..#
.##.#.#..###..#
.#.....#..##...
#..##.####.##.#
.####..#.#.#..#
##..#.#....#.##
#.#..##...#.#.#
.#.#..##..#..#.
.#.#..##..#..#.

#.#..######
...###..##.
...###..##.
#.#..######
#.......#..
.#.##.#.##.
.....#.....

#.####.#.
#.####.#.
........#
########.
#.####.##
##....##.
##....###
#.#..#.#.
#.####.##
.#....#..
..#####..

#.#.#######..##..
.#.##..#####....#
.....#...###....#
..#.#######..##..
..#.#.#..###.##.#
..#.#.#..###.##.#
..#.#######..##..
.....#...###....#
.#.##..#.###....#
#.#.#######..##..
.##.###...##....#
#.#.###....#.##.#
#.###....##.#..#.
#....#######.##.#
#.#.#...##..####.
#....#....#......
..........#######

#..##..#.#..#.###
#.....####..#..##
#.....####..#..##
#..##..#.#..#.###
#.##....##....#..
.######..###...#.
#....##...##.#...
#....##...##.#...
.######..###...#.
#.##..#.##....#..
#..##..#.#..#.###

####.#.##
####.####
.##..#..#
#####.#.#
#..###.##
#####..#.
......#.#
#######.#
.##.#####

.##..##....#...
####.##.#..##.#
.##.#..#.#..#..
#..#..###..#.##
#..#..###..#.##
.##.#..#.#..#..
####.##.#..##.#
.##..##....#...
.##.####.##.#..
..##..#..#####.
..#.#..#.#..#..
..#.#..#.#..#..
..##..#..#####.
.##.####.##.#..
.##..##....#...
.###.##.#..##.#
.##.#..#.#..#..

#.#.####.
##.#.#.#.
##..#.#..
.###.##.#
####.#.#.
####.#.#.
.###.##.#
##..#.#..
##.#.#.#.
#.#.#.##.
#.#.#.##.

#.#....#.####
.##.#.#.#.##.
.#..#.#......
..##.###.####
..##.###.####
.#..#.#......
.##.#.#.#.##.
#.#....#.####
###....#.#...
.#.#...##.##.
.#.##.#..#..#
..#.#....####
.#..#.#.#....
....#####.##.
.#.#..##.####

...##.##.
..#.#####
..#.#####
...##.##.
#.......#
#..#.#.##
#.######.
.#....#.#
#.###..##
##.#.....
##.#.....
#.###..##
.#....#.#
#.######.
#..#.#.##
#.......#
.#.##.##.

..#########
.#.#.#....#
##.##..##..
.#.##..#...
.#.###.##.#
..##.##..##
.###.#.##.#
.###.##..##
.#..#.#..#.
.#....####.
.#.##..##..
###...#..#.
#..........
.###.......
.#.#.##..##
.#.#.##..##
.###.......

#..#.##.#..
....#..#...
.###.##.###
#.#.####.#.
#..#....#..
#..#....#..
#.#.####.#.
.###.##.###
....#..#...
#..#.##.#..
.#........#
#....##.#..
#.##....##.
#...#..#...
..###..###.
..#.#..#.#.
.##......##

....#..#...
####.......
#..#.#....#
.....#....#
#####......
####.######
.##.##....#

.#.#..#.#..
###.##.####
#..#..#..##
.##..#.##..
.#..##..#..
.##.##.##..
....##.....

#.####.#..#
#.#..#.#.##
#......##.#
###..####.#
..#..#..#..
##.##.#####
.##..##.###
...##....##
...##....##
.##..##.###
##.##.#####
..#..#.....
###..####.#

#.###...#
#.###.#.#
#.#.#..##
#.#######
.#..#..##
.###.####
.########
.##..###.
.##..###.
.########
.###.####
.#..#..##
#.#######
#.#.#..##
#.###.#.#

##.######.#
..#.#..#.#.
..########.
........#..
####.##.###
....####...
###.####.##
##........#
##........#
##.#....#.#
..##....##.
...#.##.#..
..###..###.
##.#.##.#.#
##.######.#
...#....#..
###..##..##

##.#..#
###.##.
#..#.##
.#.####
.#..##.
..#####
..#####
.#..##.
.#.####

.....##.###..
....#..####.#
####.#.#..##.
#.#..##.##...
#.#..##.##...
####.#.#..##.
....#..####.#
.....##.###.#
.#.#..###..#.
..###.#.#...#
..###.#.#...#

.##.###..#.
..#.###.#.#
######.#..#
######.#..#
..#.###.#.#
.##.###..#.
#.#.##..###
##.....####
#.##.##..##
..#########
..#.....##.
..###..#...
..###..#...
..#.....##.
..#########
#.##.##..##
##......###

.#..#.#....#.
#....##....##
.#..#...##...
.......#..#..
#######.##.##
#....########
######.#..#.#
#....#.#..#..
.####...##...

####.##..##.###
####..#..#..###
..#.###..#.#.#.
#####..##..####
...##..##..##..
..#####..#####.
....#.#..#.#...

####.#..####..#
###.###########
.##.#..........
.##.#..........
###.###########
####.#..####..#
######.######.#
.####.#.####.#.
###.##.##..#..#
.######..##..##
..#.#.##.##.##.
##..###..##..##
#......#....#..
.........##....
...#.#.##..##.#

..#..##..#...
###..##..####
###..##..####
.##..##..##..
#..##..##..##
##...##...###
####....#####
...######....
##.#.##.#.##.

####.##
######.
......#
......#
.##...#
#..###.
#..#.#.
#..#.#.
#..###.
.##...#
......#
#..#..#
######.
####.##
####..#

...#....#
#..#.####
..######.
##....###
##...#.#.
..#....##
###.##...
.....###.
.....###.
###.##...
..#....##
##...#.#.
##....###

########..#.#
#######..####
..####....##.
.#.##.#.##...
..####..####.
.##..##..#.##
#.#..#.###...
........#.#.#
.#....#.#....
#......#.#..#
#......#.#..#

.#..##....#
.#..##....#
#.##.#....#
#..###.##.#
##..###..##
#.##.#.####
#.###......

.##.#....#.##..#.
#..#..##..#..#.#.
.#..#.##.#..#...#
#..##....##..##..
#..##....##..#.#.
#.#..#..#..#.####
.#..#.##....#...#
#.###....###.#...
..##..##..##....#
##...#..#...##...
####..##..#####.#
###.######.###..#
#.##.####.##.####
#.##.####.##.####
###.######.###..#
####..##..#####.#
##...#..#...##...

####..##########.
#..####..#..#..##
.#.####.#....#.##
.###..###....###.
..#.#..#......#..
##......######...
.##....##....##..
.########.##.####
##......######...

##..#....##.##.##
#..##.#.#.#....#.
....###.#..#..#..
....###.#..#..#..
#..##.#.#.#....#.
##..#....##.##.##
#....##.###.##.##
.##.##..#.#......
##.#...##.##..##.
.#..#..##........
....#.#.#..####..
##.#..####.####.#
####.#.#.#......#
#.#..#.##..#..#..
#.###..#....##...

..#.####...##..
.....#####....#
##..#..####..##
##...#..##.##.#
..#.##..###..##
##.#...#.######
....#.#..######
##.##.##.##..##
##.#######.##..
..##.###...##..
#####...##.##.#
##.#.##..#.##.#
##..#..##.####.
####....#..##..
##.##..#.#....#

#.###...#..#.
.#.#.#..#..#.
...####..##.#
.#.###..#.###
.#.##..#.####
.######...#..
#.#......##..
#.#......##..
..#####...#..
.#.##..#.####
.#.###..#.###
...####..##.#
.#.#.#..#..#.
#.###...#..#.
#.###...#..#.

.........#.
#..##..##.#
........##.
.##..##...#
........#.#
........###
#..##..##..
...##...###
..........#
.##..##..##
.##..##....
#..##..#.#.
........##.

.....######......
####.##..##.####.
##..#.####.#..##.
.#..#.....##..#.#
.#..##.##.##..#..
.#...######...#..
#.#..........#.##
.###.#.##.#.###..
.###.#.##.#.###..

.###.#.#..#.##.#.
....###..########
.##.....#..#..#..
#.#..#..#........
...###.#.#..##..#
#.#.........##...
.###.#.#.##.##.##
####.###....##...
##.####.#...##...
##..###...#....#.
.#...#.#..##..##.
.#...#.#..##..##.
##.####...#....#.

#.#.#..#.##
###.#.##..#
###.#.##..#
#.#.#..#.##
#.##.####..
.#.###...#.
.#.########
.#.###.####
.#.###...#.

##..##..###.#
##.#..#.#####
..##..##..##.
.##....##.#..
#..#..#..###.
#.##..##.#.#.
#.#.##.#.####
#.######.#..#
#.######.#..#
#.#.##.#.###.
#.##..##.#.#.

######.##..
.#.#..##...
.#.#..##...
######.##..
.#..#.#.##.
#######...#
#.#.#..##..
.##.#...##.
.#..###.#..
.....#.#..#
.....#.#..#
.#..###.#..
.##.##..##.
#.#.#..##..
#######...#
.#..#.#.##.
######.##..

######.##
###.##.##
#.######.
#.######.
###.##.##
######.##
....##.##
##.##.#.#
####.##..

.#...#..#
##...#...
....#..#.
....#..#.
##...#...
.#..##..#
####...##
##.#..#.#
#.......#
.#.....#.
..#.##.##
.#.#.....
..###.#.#
#..###.##
.##....##
..#######
..#######

.######
#####.#
#...##.
#...##.
#####.#
.######
..#...#
.#.#...
##..#..
#...##.
#...##.
##..##.
.#.#...

.#.##..#.##.#
.##.#....##..
#..####.####.
.##.#...####.
####.##.####.
#.####..#..#.
####...#.##.#
####...#.##.#
#.###...#..#.
####.##.####.
.##.#...####.

.##.#.#.....#..##
##.#..#.#.##.#.#.
.#..####....#...#
.#.#.#..##.###..#
...#.#.#....####.
..##...###.#....#
##.....###.#.....
##.....###.#.#...
..##...###.#....#
...#.#.#....####.
.#.#.#..##.###..#
.#..####....#...#
##.#..#.#.##.#.#.
.##.#.#.....#..##
.##.#.#.....#..##

#.....#..
#..##..##
.##.##.#.
###.##.#.
#..##..##
#.....#..
#.#.#.###
#....#...
#.#...##.
#.##..##.
######...
######...
#.##..##.

##..#.#
###.#.#
###.#.#
##..#.#
#.##.#.
.#....#
..#.###
..#.#.#
.##..#.
....###
###....
#..#.##
######.
.##..##
#.###.#

..##..#.#.##.#.
#..#..##.#..#.#
######..######.
..#####........
######.##.##.##
######.##.##.##
..#####........
######..######.
#.....##.#..#.#
`;

if (runs[0]) console.log('part1 sample', part1(inputSample)); // 405
if (runs[1]) console.log('part1 real', part1(inputReal)); // 34821
if (runs[2]) console.log('part2 sample', part2(inputSample)); // 400
if (runs[3]) console.log('part2 real', part2(inputReal)); // 36919
